<!doctype html><html><head><meta charset="utf-8"><title>Trend – Podcast</title></head>
<body>
<h1>Trend – Podcast ({{ report_date or "brak daty" }})</h1>

<!-- DEBUG: Sprawdź co otrzymujemy -->
<p><strong>DEBUG:</strong> growth type: {{ growth.__class__.__name__ }}, length: {{ growth|length if growth else 0 }}</p>
<p><strong>DEBUG:</strong> growth keys: {{ growth.keys() if growth and growth is mapping else 'not a dict' }}</p>
<p><strong>DEBUG:</strong> growth sample: {{ growth[:2] if growth and growth is sequence else 'not a list' }}</p>

{% set items_all = (growth if growth is defined else []) %}
{% set items_sorted = items_all | sort(attribute='views_today', reverse=True) %}
{% set longs = items_sorted | selectattr('is_short', 'equalto', false) | list %}
{% set shorts = items_sorted | selectattr('is_short', 'equalto', true) | list %}

<style>
  table{border-collapse:collapse;width:100%;font-family:system-ui,Arial,sans-serif}
  th,td{border:1px solid #ddd;padding:8px}
  th{position:sticky;top:0;background:#f7f7f7;text-align:left}
  tbody tr:nth-child(odd){background:#fafafa}
  .muted{color:#777}
</style>

<h2>Top dzienne przyrosty (Long-form)</h2>

{% if longs and longs|length > 0 %}
<table>
  <thead>
    <tr>
      <th>#</th>
      <th>Tytuł</th>
      <th>Dzisiejsze</th>
      <th>Wczoraj</th>
      <th>Δ</th>
    </tr>
  </thead>
  <tbody>
    {% for row in longs[:50] %}
      <tr>
        <td>{{ loop.index }}</td>
        <td>
          <a href="https://www.youtube.com/watch?v={{ row.video_id }}" target="_blank" rel="noopener">
            {{ row.title }}
          </a>
        </td>
        <td>{{ row.views_today | default('-') }}</td>
        <td>{{ row.views_yesterday | default('-') }}</td>
        <td>{{ row.delta | default('-') }}</td>
      </tr>
    {% endfor %}
  </tbody>
</table>
{% else %}
  <p class="muted">Brak danych Long-form do wyświetlenia.</p>
{% endif %}

<h2 style="margin-top:24px;">Top dzienne przyrosty (Shorts)</h2>

{% if shorts and shorts|length > 0 %}
<table>
  <thead>
    <tr>
      <th>#</th>
      <th>Tytuł</th>
      <th>Dzisiejsze</th>
      <th>Wczoraj</th>
      <th>Δ</th>
    </tr>
  </thead>
  <tbody>
    {% for row in shorts[:50] %}
      <tr>
        <td>{{ loop.index }}</td>
        <td>
          <a href="https://www.youtube.com/watch?v={{ row.video_id }}" target="_blank" rel="noopener">
            {{ row.title }}
          </a>
        </td>
        <td>{{ row.views_today | default('-') }}</td>
        <td>{{ row.views_yesterday | default('-') }}</td>
        <td>{{ row.delta | default('-') }}</td>
      </tr>
    {% endfor %}
  </tbody>
</table>
{% else %}
  <p class="muted">Brak danych Shorts do wyświetlenia.</p>
{% endif %}

<h3>Popularne godziny publikacji</h3>
<p><strong>Long-form – top godzina:</strong> {{ stats.longform_top_hour | default('brak') }}</p>
<p><strong>Shorts – top godzina:</strong> {{ stats.shorts_top_hour | default('brak') }}</p>
</body></html>
